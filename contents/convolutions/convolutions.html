
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Convolutions Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-bibtex-cite/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-api-language-selector/api-language-selector.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../taylor_series_expansion/taylor_series_expansion.html" />
    
    
    <link rel="prev" href="../bitlogic/bitlogic.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Algorithm Archive
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../introduction/introduction.html">
            
                <a href="../introduction/introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../how_to_contribute/how_to_contribute.html">
            
                <a href="../how_to_contribute/how_to_contribute.html">
            
                    
                    How To Contribute
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../data_structures/data_structures.html">
            
                <a href="../data_structures/data_structures.html">
            
                    
                    Data Structures
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../stacks_and_queues/stacks_and_queues.html">
            
                <a href="../stacks_and_queues/stacks_and_queues.html">
            
                    
                    Stacks and Queues
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../mathematical_background/mathematical_background.html">
            
                <a href="../mathematical_background/mathematical_background.html">
            
                    
                    Mathematical Background
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../notation/notation.html">
            
                <a href="../notation/notation.html">
            
                    
                    Complexity Notation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../bitlogic/bitlogic.html">
            
                <a href="../bitlogic/bitlogic.html">
            
                    
                    Bit Logic
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.3" data-path="convolutions.html">
            
                <a href="convolutions.html">
            
                    
                    Convolutions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../taylor_series_expansion/taylor_series_expansion.html">
            
                <a href="../taylor_series_expansion/taylor_series_expansion.html">
            
                    
                    Taylor Series
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../sorting_and_searching/sorting_and_searching.html">
            
                <a href="../sorting_and_searching/sorting_and_searching.html">
            
                    
                    Sorting and Searching
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../bubble_sort/bubble_sort.html">
            
                <a href="../bubble_sort/bubble_sort.html">
            
                    
                    Bubble Sort
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../bogo_sort/bogo_sort.html">
            
                <a href="../bogo_sort/bogo_sort.html">
            
                    
                    Bogo Sort
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../tree_traversal/tree_traversal.html">
            
                <a href="../tree_traversal/tree_traversal.html">
            
                    
                    Tree Traversal
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../euclidean_algorithm/euclidean_algorithm.html">
            
                <a href="../euclidean_algorithm/euclidean_algorithm.html">
            
                    
                    Euclidean Algorithm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../monte_carlo_integration/monte_carlo_integration.html">
            
                <a href="../monte_carlo_integration/monte_carlo_integration.html">
            
                    
                    Monte Carlo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../matrix_methods/matrix_methods.html">
            
                <a href="../matrix_methods/matrix_methods.html">
            
                    
                    Matrix Methods
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../gaussian_elimination/gaussian_elimination.html">
            
                <a href="../gaussian_elimination/gaussian_elimination.html">
            
                    
                    Gaussian Elimination
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../thomas_algorithm/thomas_algorithm.html">
            
                <a href="../thomas_algorithm/thomas_algorithm.html">
            
                    
                    Thomas Algorithm
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../computational_geometry/computational_geometry.html">
            
                <a href="../computational_geometry/computational_geometry.html">
            
                    
                    Computational Geometry
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../gift_wrapping/gift_wrapping.html">
            
                <a href="../gift_wrapping/gift_wrapping.html">
            
                    
                    Gift Wrapping
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1.1" data-path="../jarvis_march/jarvis_march.html">
            
                <a href="../jarvis_march/jarvis_march.html">
            
                    
                    Jarvis March
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.1.2" data-path="../graham_scan/graham_scan.html">
            
                <a href="../graham_scan/graham_scan.html">
            
                    
                    Graham Scan
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../cooley_tukey/cooley_tukey.html">
            
                <a href="../cooley_tukey/cooley_tukey.html">
            
                    
                    FFT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../decision_problems/decision_problems.html">
            
                <a href="../decision_problems/decision_problems.html">
            
                    
                    Decision Problems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../stable_marriage_problem/stable_marriage_problem.html">
            
                <a href="../stable_marriage_problem/stable_marriage_problem.html">
            
                    
                    Stable Marriage Problem
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../differential_equations/differential_equations.html">
            
                <a href="../differential_equations/differential_equations.html">
            
                    
                    Differential Equation Solvers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="../forward_euler_method/forward_euler_method.html">
            
                <a href="../forward_euler_method/forward_euler_method.html">
            
                    
                    Forward Euler Method
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../physics_solvers/physics_solvers.html">
            
                <a href="../physics_solvers/physics_solvers.html">
            
                    
                    Physics Solvers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="../verlet_integration/verlet_integration.html">
            
                <a href="../verlet_integration/verlet_integration.html">
            
                    
                    Verlet Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="../quantum_systems/quantum_systems.html">
            
                <a href="../quantum_systems/quantum_systems.html">
            
                    
                    Quantum Systems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.2.1" data-path="../split-operator_method/split-operator_method.html">
            
                <a href="../split-operator_method/split-operator_method.html">
            
                    
                    Split-Operator Method
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="../data_compression/data_compression.html">
            
                <a href="../data_compression/data_compression.html">
            
                    
                    Data Compression
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="../huffman_encoding/huffman_encoding.html">
            
                <a href="../huffman_encoding/huffman_encoding.html">
            
                    
                    Huffman Encoding
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="../quantum_information/quantum_information.html">
            
                <a href="../quantum_information/quantum_information.html">
            
                    
                    Quantum Information
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Convolutions</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="convolutions">Convolutions</h1>
<p>Alright, I am going to come right out and say it: convolutions can be confusing.
Not only are they hard to really describe, but if you do not see them in practice, it&apos;s hard to understand why you would ever want to use them.
I&apos;m going to do what I can to describe them in an intuitive way; however, I may need to come back to this in the future.
Let me know if there is anything here that is unclear, and I&apos;ll do what I can to clear it up.</p>
<p>If you take two functions <script type="math/tex; ">f(x)</script> and <script type="math/tex; ">g(x)</script>, there are a number of ways you can combine them.
All basic operations can do this (addition, subtraction, multiplication, and division), but there are also special operations that only work with functions and do not work on standard variables or numbers.
For example, <script type="math/tex; ">f \circ g</script> is a <em>composition</em> of the two functions, where you plug <script type="math/tex; ">g(x)</script> into <script type="math/tex; ">f(x)</script>.
A convolution is another function-related operation, and is often notated with a star (<script type="math/tex; ">*</script>) operator, where</p>
<p><script type="math/tex; ">f(x)*g(x)=c(x)</script></p>
<p>provides a third function <script type="math/tex; ">c(x)</script> that blends <script type="math/tex; ">f(x)</script> and <script type="math/tex; ">g(x)</script>.</p>
<p>As a rather important side-note: there is an incredibly similar operator known as a <em>correlation</em> which will be discussed in the near future.
For now, let&apos;s focus on convolutions, which are defined as:</p>
<p><script type="math/tex; ">(f*g)(x) = \int_{-\infty}^{\infty}f(\xi)g(x-\xi)d\xi = \int_{-\infty}^{\infty}f(x-\xi)g(\xi)d\xi</script></p>
<p>Note that in this case, <script type="math/tex; ">x</script> is not necessarily a spatial element.
Often times, it is time or something else entirely!
The easiest way to think about this is that the function <script type="math/tex; ">g(x)</script> is being shifted across all of space by the variable <script type="math/tex; ">\xi</script>.
At every point <script type="math/tex; ">x</script>, we multiply <script type="math/tex; ">f(x)</script> and <script type="math/tex; ">g(x)</script> and integrate the multiplied output to find the convolution for that spatial step, <script type="math/tex; ">(f*g)(x)</script>.
Note that in code, this is often discretized to look like:</p>
<p><script type="math/tex; ">(f*g)[n] = \sum_{m = -\infty}^{\infty}f[m]g[n-m] = \sum_{m = -\infty}^{\infty}f[n-m]g[m]</script></p>
<p>Where <code>f[n]</code> and <code>g[n]</code> are arrays of some form.
This means we basically just need to keep one array steady, flip the second array around, and move it through the first array one step at a time, performing a simple element-wise multiplication each step.</p>
<!---This can be seen in the following animation:--->
<!---ADD ANIMATION--->
<p>In code, this looks something like:</p>
<div class="code-method"><div class="code-method-definition"></div><div class="code-method-code"><div class="code-method-sample" data-lang="jl" data-name="Julia"><pre class="language-"><code class="lang-julia"><span class="token keyword">function</span> conv<span class="token punctuation">(</span>signal1<span class="token punctuation">:</span><span class="token punctuation">:</span>Vector<span class="token punctuation">{</span>Complex<span class="token punctuation">}</span><span class="token punctuation">,</span> signal2<span class="token punctuation">:</span><span class="token punctuation">:</span>Vector<span class="token punctuation">{</span>Complex<span class="token punctuation">}</span><span class="token punctuation">)</span>
    n <span class="token operator">=</span> length<span class="token punctuation">(</span>signal1<span class="token punctuation">)</span> <span class="token operator">+</span> length<span class="token punctuation">(</span>signal2<span class="token punctuation">)</span>
    out <span class="token operator">=</span> Vector<span class="token punctuation">{</span>Complex<span class="token punctuation">}</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
    sum <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">:</span>n
        <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">:</span>i
            <span class="token keyword">if</span><span class="token punctuation">(</span>j <span class="token operator">&lt;</span> length<span class="token punctuation">(</span>signal1<span class="token punctuation">)</span><span class="token punctuation">)</span>
                sum <span class="token operator">+=</span> signal1<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*</span> signal2<span class="token punctuation">[</span>i<span class="token operator">-</span>j<span class="token punctuation">]</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
        out<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sum
        sum <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">end</span>

    <span class="token keyword">return</span> out
<span class="token keyword">end</span>
</code></pre>
</div><div class="code-method-sample" data-lang="hs" data-name="Haskell"><pre class="language-"><code class="lang-haskell"><span class="token hvariable">convolution</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Num</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span>
<span class="token hvariable">convolution</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token operator"> . </span><span class="token builtin">zipWith</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">reverse</span> <span class="token hvariable">x</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator"> . </span><span class="token hvariable">spread</span>
  <span class="token keyword">where</span>
    <span class="token hvariable">spread</span> <span class="token operator">=</span> <span class="token builtin">init</span><span class="token operator"> . </span><span class="token hvariable">tails</span><span class="token operator"> . </span><span class="token punctuation">(</span><span class="token builtin">replicate</span> <span class="token punctuation">(</span><span class="token builtin">length</span> <span class="token hvariable">x</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">0</span> <span class="token operator">++</span><span class="token punctuation">)</span>
</code></pre>
</div><div class="code-method-sample" data-lang="c" data-name="C"><pre class="language-"><code class="lang-c"><span class="token keyword">void</span> <span class="token function">conv</span><span class="token punctuation">(</span><span class="token keyword">double</span> complex <span class="token operator">*</span>signal1<span class="token punctuation">,</span> <span class="token keyword">double</span> complex <span class="token operator">*</span>signal2<span class="token punctuation">,</span> <span class="token keyword">double</span> complex<span class="token operator">*</span> out<span class="token punctuation">,</span>
          size_t n1<span class="token punctuation">,</span> size_t n2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">double</span> complex sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>n1 <span class="token operator">&lt;</span> n2<span class="token operator">?</span> n2 <span class="token punctuation">:</span> n1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> n1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sum <span class="token operator">+</span><span class="token operator">=</span> signal1<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*</span> signal2<span class="token punctuation">[</span>i<span class="token operator">-</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        out<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sum<span class="token punctuation">;</span>
        sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="cpp" data-name="C++"><pre class="language-"><code class="lang-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> S1<span class="token punctuation">,</span> <span class="token keyword">typename</span> S2<span class="token punctuation">,</span> <span class="token keyword">typename</span> Out<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">conv</span><span class="token punctuation">(</span>
    S1 <span class="token keyword">const</span> s1<span class="token punctuation">,</span>
    S1 <span class="token keyword">const</span> s1_last<span class="token punctuation">,</span>
    S2 <span class="token keyword">const</span> s2<span class="token punctuation">,</span>
    S2 <span class="token keyword">const</span> s2_last<span class="token punctuation">,</span>
    Out <span class="token keyword">const</span> out<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">auto</span> <span class="token keyword">const</span> size1 <span class="token operator">=</span> s1_last <span class="token operator">-</span> s1<span class="token punctuation">;</span>
  <span class="token keyword">auto</span> <span class="token keyword">const</span> size2 <span class="token operator">=</span> s2_last <span class="token operator">-</span> s2<span class="token punctuation">;</span>
  <span class="token keyword">auto</span> <span class="token keyword">const</span> size <span class="token operator">=</span> size1 <span class="token operator">+</span> size2<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>ptrdiff_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c64 sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>ptrdiff_t j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> size1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sum <span class="token operator">+</span><span class="token operator">=</span> s1<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*</span> s2<span class="token punctuation">[</span>i <span class="token operator">-</span> j<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    out<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sum<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="python" data-name="Python"><pre class="language-"><code class="lang-python"><span class="token keyword">def</span> <span class="token function">conv</span><span class="token punctuation">(</span>signal1<span class="token punctuation">,</span> signal2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Discrete convolution by definition&quot;&quot;&quot;</span>

    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>signal1<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>signal2<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
    out <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> j <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>signal1<span class="token punctuation">)</span> <span class="token operator">and</span> i <span class="token operator">-</span> j  <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>signal2<span class="token punctuation">)</span><span class="token punctuation">:</span>
                s <span class="token operator">+=</span> signal1<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">*</span> signal2<span class="token punctuation">[</span>i <span class="token operator">-</span> j<span class="token punctuation">]</span>

        out<span class="token punctuation">.</span>append<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

    <span class="token keyword">return</span> out
</code></pre>
</div></div></div>

<p>Note that in this case, the output array will be the size of <code>f[n]</code> and <code>g[n]</code> put together.
Sometimes, though, we have an large size for <code>f[n]</code> and a small size for <code>g[n]</code>.
In this case <code>g[n]</code> is often called a <em>filter</em>, and often times when we are using a filter on an array (that might represent an image or some form of data), we want the output array to be the same size as the input.
In this case, rather than outputting a larger array, we often do something special at the borders of the array.
Depending on the situation, this may be necessary.
Note that there are different methods to deal with the edges in this case, so it&apos;s best to do whatever seems right when the situation arises.</p>
<h3 id="convolutional-theorem">Convolutional Theorem</h3>
<p>Now, let me tell you about a bit of black computational magic:</p>
<p><strong>Convolutions can be performed with Fourier Transforms!</strong></p>
<p>That is crazy!
It&apos;s also incredibly hard to explain, so let me do my best.
As described in the chapter on <a href="../cooley_tukey/cooley_tukey.html">Fourier Transforms</a>, Fourier Transforms allow programmers to move from real space to frequency space.
When we transform a wave into frequency space, we see a single peak in frequency space related to the frequency of that wave.
No matter what function we send into a Fourier Transform, the frequency-space image can be interpreted as a series of different waves with a specified frequency.</p>
<p>So here&apos;s the idea: if we take two functions <script type="math/tex; ">f(x)</script> and <script type="math/tex; ">g(x)</script> and move them to frequency space to be <script type="math/tex; ">\hat f(\xi)</script> and <script type="math/tex; ">\hat g(\xi)</script>, we can then multiply those two functions and transform them back into a third function to blend the signals together.
In this way, we will have a third function that relates the frequency-space images of the two input functions.
<em>This is precisely a convolution!</em></p>
<p>Don&apos;t believe me?
Well, this is because of something known as the <em>convolution theorem</em> which looks something like this:</p>
<p><script type="math/tex; ">\mathcal{F}(f*g) = \mathcal{F}(f) \cdot \mathcal{F}(g)</script></p>
<p>Where <script type="math/tex; ">\mathcal{F}</script> denotes the Fourier Transform.
Now, by using a Fast Fourier Transform (fft) in code, this can take a standard convolution on two arrays of length <script type="math/tex; ">n</script>, which is an <script type="math/tex; ">\mathcal{O}(n^2)</script> process, to <script type="math/tex; ">\mathcal{O}(n\log(n))</script>.
This means that the convolution theorem is fundamental to creating fast convolutional methods for large inputs, assuming that both of the input signals are similar sizes.
That said, it is debatable whether the convolution theorem will be faster when the filter size is small.
Also: depending on the language used, we might need to read in a separate library for FFT&apos;s.</p>
<div class="code-method"><div class="code-method-definition"></div><div class="code-method-code"><div class="code-method-sample" data-lang="jl" data-name="Julia"><p>That said, Julia has an in-built fft routine, so the code for this method could not be simpler:</p>
<pre class="language-"><code class="lang-julia"><span class="token keyword">function</span> conv_fft<span class="token punctuation">(</span>signal1<span class="token punctuation">:</span><span class="token punctuation">:</span>Vector<span class="token punctuation">{</span>Complex<span class="token punctuation">}</span><span class="token punctuation">,</span> signal2<span class="token punctuation">:</span><span class="token punctuation">:</span>Vector<span class="token punctuation">{</span>Complex<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> ifft<span class="token punctuation">(</span>fft<span class="token punctuation">(</span>signal1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token operator">*</span>fft<span class="token punctuation">(</span>signal2<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>
</code></pre>
<p>Where the <code>.*</code> operator is an element-wise multiplication.</p>
</div><div class="code-method-sample" data-lang="hs" data-name="Haskell"><pre class="language-"><code class="lang-haskell"><span class="token hvariable">convolutionFFT</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token constant">Complex</span> <span class="token constant">Double</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token constant">Complex</span> <span class="token constant">Double</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token constant">Complex</span> <span class="token constant">Double</span><span class="token punctuation">]</span>
<span class="token hvariable">convolutionFFT</span> <span class="token hvariable">x</span> <span class="token hvariable">y</span> <span class="token operator">=</span> <span class="token hvariable">elems</span> <span class="token operator">$</span> <span class="token hvariable">idft</span> <span class="token operator">$</span> <span class="token hvariable">liftArray2</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">fft</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">fft</span> <span class="token hvariable">y</span><span class="token punctuation">)</span>
  <span class="token keyword">where</span>
    <span class="token hvariable">fft</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token hvariable">dft</span> <span class="token operator">$</span> <span class="token hvariable">listArray</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">length</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token hvariable">a</span>
</code></pre>
<p>Where the <code>.*</code> operator is an element-wise multiplication.</p>
</div><div class="code-method-sample" data-lang="c" data-name="C"><pre class="language-"><code class="lang-c"><span class="token keyword">void</span> <span class="token function">conv_fft</span><span class="token punctuation">(</span><span class="token keyword">double</span> complex <span class="token operator">*</span>signal1<span class="token punctuation">,</span> <span class="token keyword">double</span> complex <span class="token operator">*</span>signal2<span class="token punctuation">,</span>
              <span class="token keyword">double</span> complex<span class="token operator">*</span> out<span class="token punctuation">,</span> size_t n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fft</span><span class="token punctuation">(</span>signal1<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fft</span><span class="token punctuation">(</span>signal2<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        out<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> signal1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> signal2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">ifft</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="cpp" data-name="C++"><pre class="language-"><code class="lang-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> S1<span class="token punctuation">,</span> <span class="token keyword">typename</span> S2<span class="token punctuation">,</span> <span class="token keyword">typename</span> Out<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">conv_fft</span><span class="token punctuation">(</span>S1 <span class="token keyword">const</span> s1<span class="token punctuation">,</span> S1 <span class="token keyword">const</span> s1_last<span class="token punctuation">,</span> S2 <span class="token keyword">const</span> s2<span class="token punctuation">,</span> Out <span class="token keyword">const</span> out<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">auto</span> <span class="token keyword">const</span> size <span class="token operator">=</span> s1_last <span class="token operator">-</span> s1<span class="token punctuation">;</span>

  <span class="token function">fft</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s1_last<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fft</span><span class="token punctuation">(</span>s2<span class="token punctuation">,</span> s2 <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">auto</span> s1_it <span class="token operator">=</span> s1<span class="token punctuation">;</span>
  <span class="token keyword">auto</span> s2_it <span class="token operator">=</span> s2<span class="token punctuation">;</span>
  <span class="token keyword">auto</span> out_it <span class="token operator">=</span> out<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> s1_it <span class="token operator">!=</span> s1_last<span class="token punctuation">;</span> <span class="token operator">++</span>s1_it<span class="token punctuation">,</span> <span class="token operator">++</span>s2_it<span class="token punctuation">,</span> <span class="token operator">++</span>out_it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">*</span>out_it <span class="token operator">=</span> <span class="token operator">*</span>s1_it <span class="token operator">*</span> <span class="token operator">*</span>s2_it<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">inverse_fft</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> out_it<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div><div class="code-method-sample" data-lang="python" data-name="Python"><pre class="language-"><code class="lang-python"><span class="token keyword">def</span> <span class="token function">conv_fft</span><span class="token punctuation">(</span>signal1<span class="token punctuation">,</span> signal2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Convolution using fft and convolutional theorem&quot;&quot;&quot;</span>

    signal1 <span class="token operator">=</span> signal1<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    signal2 <span class="token operator">=</span> signal2<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># pad signals to same len</span>
    max_len <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>signal1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>signal2<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>max_len <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>signal1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        signal1<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>max_len <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>signal2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        signal2<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    fft_s1 <span class="token operator">=</span> fft<span class="token punctuation">(</span>signal1<span class="token punctuation">)</span>
    fft_s2 <span class="token operator">=</span> fft<span class="token punctuation">(</span>signal2<span class="token punctuation">)</span>
    out <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>signal1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        out<span class="token punctuation">.</span>append<span class="token punctuation">(</span>fft_s1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> fft_s2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token builtin">list</span><span class="token punctuation">(</span>ifft<span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
</div></div></div>

<p>This method also has the added advantage that it will <em>always output an array of the size of your signal</em>; however, if your signals are not of equal size, we need to pad the smaller signal with zeros.
Also note that the Fourier Transform is a periodic or cyclical operation, so there are no real edges in this method, instead the arrays &quot;wrap around&quot; to the other side.
For this reason, this convolution is often called a <em>cyclic convolution</em> instead of a <em>linear convolution</em> like above.
Note that cyclic convolutions can definitely still be done without Fourier Transforms and we can do linear convolutions with Fourier Transforms, but it makes the code slightly more complicated than described above.</p>
<!---
If you are still having trouble wrapping your head around what the convolution theorem actually means, maybe this graphic will help:

ADD IMAGE

Remember that each element of the frequency-space array is a different waveform in real-space, so when you multiply two frequency-space arrays, you are selectively amplifying similar waveforms.
--->
<script>
MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
</script>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../bitlogic/bitlogic.html" class="navigation navigation-prev " aria-label="Previous page: Bit Logic">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../taylor_series_expansion/taylor_series_expansion.html" class="navigation navigation-next " aria-label="Next page: Taylor Series">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Convolutions","level":"1.5.3","depth":2,"next":{"title":"Taylor Series","level":"1.5.4","depth":2,"path":"contents/taylor_series_expansion/taylor_series_expansion.md","ref":"contents/taylor_series_expansion/taylor_series_expansion.md","articles":[]},"previous":{"title":"Bit Logic","level":"1.5.2","depth":2,"path":"contents/bitlogic/bitlogic.md","ref":"contents/bitlogic/bitlogic.md","articles":[]},"dir":"ltr"},"config":{"plugins":["fontsettings","mathjax@https://github.com/algorithm-archivists/plugin-mathjax","bibtex-cite","creativecommons","wordcount","api-language-selector@https://github.com/algorithm-archivists/gitbook-plugin-api-language-selector.git","include-codeblock","ga","bulk-redirect","prism","-highlight"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"api-language-selector":{"languages":[{"lang":"jl","name":"Julia","default":true},{"lang":"bash","name":"Bash"},{"lang":"cs","name":"C#"},{"lang":"cpp","name":"C++"},{"lang":"c","name":"C"},{"lang":"c8","name":"chip-8"},{"lang":"py","name":"Python"},{"lang":"js","name":"JavaScript"},{"lang":"scratch","name":"Scratch"},{"lang":"hs","name":"Haskell"},{"lang":"rs","name":"Rust"},{"lang":"ml","name":"OCaml"},{"lang":"java","name":"Java"},{"lang":"clj","name":"Clojure"},{"lang":"elm","name":"Elm"},{"lang":"LabVIEW","name":"LabVIEW"},{"lang":"d","name":"D"},{"lang":"go","name":"Go"},{"lang":"swift","name":"Swift"},{"lang":"racket","name":"Racket"},{"lang":"m","name":"Matlab"},{"lang":"r","name":"R"},{"lang":"ti83b","name":"TI-83 Basic"},{"lang":"lua","name":"Lua"},{"lang":"crystal","name":"Crystal"},{"lang":"php","name":"PHP"},{"lang":"lisp","name":"Common Lisp"},{"lang":"nim","name":"Nim"},{"lang":"asm-x64","name":"X86-64 Assembly"},{"lang":"f90","name":"Fortran90"},{"lang":"factor","name":"Factor"},{"lang":"ws","name":"Whitespace"},{"lang":"scala","name":"Scala"},{"lang":"emojic","name":"Emojicode"},{"lang":"lolcode","name":"LOLCODE"},{"lang":"piet","name":"Piet"}]},"prism":{"lang":{"asm-x64":"nasm"},"ignore":["emojicode","text"],"css":["prismjs/themes/prism-tomorrow.css"]},"wordcount":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"family":"sans","size":2,"theme":"white"},"bulk-redirect":{"basepath":"/","redirectsFile":"redirects.json"},"bibtex-cite":{},"creativecommons":{},"mathjax":{"forceSVG":false,"version":"2.6.1"},"ga":{"configuration":"auto","token":"UA-118252470-1"},"include-codeblock":{"check":false,"edit":false,"fixlang":true,"lang":"","template":"default","theme":"chrome","unindent":true},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","lunr":{"maxIndexSize":1000000000},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"bibCount":0,"variables":{},"bib":[{"citationKey":"CT1965","entryType":"ARTICLE","entryTags":{"TITLE":"An algorithm for the machine calculation of complex Fourier series","AUTHOR":"Cooley, James W and Tukey, John W","JOURNAL":"Mathematics of computation","VOLUME":"19","NUMBER":"90","PAGES":"297--301","YEAR":"1965","PUBLISHER":"JSTOR"}},{"citationKey":"JM1973","entryType":"ARTICLE","entryTags":{"TITLE":"On the identification of the convex hull of a finite set of points in the plane","AUTHOR":"Jarvis, Ray A","JOURNAL":"Information processing letters","VOLUME":"2","NUMBER":"1","PAGES":"18--21","YEAR":"1973","PUBLISHER":"Elsevier"}},{"citationKey":"GS1972","entryType":"ARTICLE","entryTags":{"TITLE":"An efficient algorithm for determining the convex hull of a finite planar set","AUTHOR":"Graham, Ronald L","JOURNAL":"Information processing letters","VOLUME":"1","NUMBER":"4","PAGES":"132--133","YEAR":"1972","PUBLISHER":"Elsevier"}}],"gitbook":"3.x.x"},"file":{"path":"contents/convolutions/convolutions.md","mtime":"2018-12-28T20:42:07.202Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-12-28T20:44:01.565Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-mathjax/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-api-language-selector/api-language-selector.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    

    </body>
</html>

